<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lee.mapper.BlogMapperCustom">

    <resultMap id="BaseResultMap" type="com.lee.vo.BlogVo">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="comment_size" jdbcType="INTEGER" property="commentSize"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="read_size" jdbcType="INTEGER" property="readSize"/>
        <result column="summary" jdbcType="VARCHAR" property="summary"/>
        <result column="tags" jdbcType="VARCHAR" property="tags"/>
        <result column="title" jdbcType="VARCHAR" property="title"/>
        <result column="vote_size" jdbcType="INTEGER" property="voteSize"/>
        <result column="content" jdbcType="LONGVARCHAR" property="content"/>
        <result column="html_content" jdbcType="LONGVARCHAR" property="htmlContent"/>
        <result column="image_list" jdbcType="LONGVARCHAR" property="imageList"/>
        <!--关联查询的字段-->
        <result column="username" jdbcType="VARCHAR" property="userName"/>
        <result column="avatar" jdbcType="VARCHAR" property="avatar"/>
        <result column="category" jdbcType="VARCHAR" property="category"/>
    </resultMap>

    <!--根据categoryId和userId查询分类名称和博主用户名-->
    <select id="getAllBlogVoList" resultMap="BaseResultMap">
        SELECT
            b.*,
            c.`name` AS category,
            u.username AS username,
            u.avatar AS avatar
        FROM
            blog b
            LEFT JOIN `user` u ON b.user_id = u.id
            LEFT JOIN category c ON b.category_id = c.id
        ORDER BY
	        create_time DESC
  </select>

    <select id="queryBlogByUsername" parameterType="String" resultMap="BaseResultMap">
        SELECT
            b.*,
            c.`name` AS category,
            u.username AS username,
            u.avatar AS avatar
        FROM
            blog b
            LEFT JOIN `user` u ON b.user_id = u.id
            LEFT JOIN category c ON b.category_id = c.id
        WHERE
            username = #{username}
        ORDER BY
            create_time DESC
    </select>


    <!-- 插入blog返回blogId -->
    <insert id="saveBlog" parameterType="com.lee.pojo.Blog" useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO blog
        <trim prefix="(" suffix=")" suffixOverrides=",">
            title,summary,content,tags,user_id,category_id,create_time,
            <if test="imageList != null">
                image_list,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            #{title},#{summary},#{content},#{tags},#{userId},#{categoryId},#{createTime},
            <if test="imageList != null">
                #{imageList},
            </if>
        </trim>
    </insert>

</mapper>